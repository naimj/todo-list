<!-- GlobalDialog.vue -->
<template>
  <v-dialog
    v-model="localModel"
    max-width="520"
    transition="dialog-bottom-transition"
    scrim="rgba(0,0,0,0.4)"
  >
    <v-card class="pa-4">

      <!-- Header -->
      <v-card-title class="d-flex align-center text-h6 mb-1">
        <v-icon
          v-if="icon"
          :icon="icon"
          size="24"
          class="mr-2"
        />
        <span>{{ title }}</span>
      </v-card-title>

      <!-- Sous-titre / texte -->
      <v-card-subtitle v-if="subtitle" class="text-body-2 text-medium-emphasis mb-1">
        {{ subtitle }}
      </v-card-subtitle>

      <!-- Body -->
      <v-card-text class="text-body-2 text-medium-emphasis">
        <!-- Slot custom -->
        <slot name="body">
          {{ text }}
        </slot>
      </v-card-text>

      <v-divider class="my-3" />

      <!-- Actions -->
      <v-card-actions class="justify-end ga-2">
        <v-btn
          v-for="btn in visibleButtons"
          :key="btn.key"
          :color="btn.color || 'primary'"
          :variant="btn.variant || 'flat'"
          :prepend-icon="btn.icon"
          :loading="btn.loading"
          :disabled="btn.disabled"
          :size="btn.size || 'default'"
          @click="onBtnClick(btn)"
        >
          {{ btn.label }}
        </v-btn>
      </v-card-actions>
    </v-card>
  </v-dialog>
</template>

<script setup>
import { computed } from 'vue'

const props = defineProps({
  modelValue: {
    type: Boolean,
    default: false,
  },
  title: {
    type: String,
    default: '',
  },
  subtitle: {
    type: String,
    default: '',
  },
  text: {
    type: String,
    default: '',
  },
  icon: {
    type: String,
    default: null,
  },
  /**
   * Tableau de boutons :
   * [
   *   {
   *     key: 'delete',
   *     label: 'Supprimer',
   *     color: 'error',
   *     variant: 'flat',
   *     icon: 'mdi-delete',
   *     show: true,          // optionnel (par défaut: true)
   *     close: true,         // optionnel (par défaut: true)
   *     disabled: false,     // optionnel
   *     loading: false,      // optionnel
   *   }
   * ]
   */
  buttons: {
    type: Array,
    default: () => [],
  },
})

const emit = defineEmits(['update:modelValue', 'action'])

const localModel = computed({
  get: () => props.modelValue,
  set: (val) => emit('update:modelValue', val),
})

const visibleButtons = computed(() =>
  props.buttons.filter((btn) => btn.show !== false),
)

const onBtnClick = (btn) => {
  // remonte l'action au parent avec l'objet complet et la clé
  emit('action', btn.key, btn)

  // On ferme par défaut, sauf si close === false
  if (btn.close !== false) {
    emit('update:modelValue', false)
  }
}
</script>


----------------------------------------------------
<!-- ParentExample.vue -->
<template>
  <v-btn color="primary" @click="openDeleteDialog">
    Ouvrir dialog de suppression
  </v-btn>

  <v-btn color="secondary" class="ml-2" @click="openConfirmDialog">
    Ouvrir dialog de confirmation
  </v-btn>

  <GlobalDialog
    v-model="dialog.visible"
    :title="dialog.title"
    :subtitle="dialog.subtitle"
    :text="dialog.text"
    :icon="dialog.icon"
    :buttons="dialog.buttons"
    @action="handleDialogAction"
  >
    <!-- Exemple d'utilisation du slot body (optionnel) -->
    <template #body v-if="dialog.useCustomBody">
      <p class="mb-2">
        Tu es sur le point de supprimer
        <strong>{{ itemName }}</strong>.
      </p>
      <p class="text-caption text-medium-emphasis">
        Cette action est irréversible.
      </p>
    </template>
  </GlobalDialog>
</template>

<script setup>
import { reactive, ref } from 'vue'
import GlobalDialog from '@/components/GlobalDialog.vue'

const itemName = ref('Utilisateur #123')

const dialog = reactive({
  visible: false,
  title: '',
  subtitle: '',
  text: '',
  icon: null,
  buttons: [],
  useCustomBody: false,
})

const openDeleteDialog = () => {
  dialog.title = 'Confirmer la suppression'
  dialog.subtitle = 'Action irréversible'
  dialog.text = 'Souhaites-tu vraiment supprimer cet élément ?'
  dialog.icon = 'mdi-alert-circle-outline'
  dialog.useCustomBody = true

  dialog.buttons = [
    {
      key: 'cancel',
      label: 'Annuler',
      color: 'grey',
      variant: 'text',
      show: true,
      close: true,
    },
    {
      key: 'delete',
      label: 'Supprimer',
      color: 'error',
      variant: 'flat',
      icon: 'mdi-delete',
      show: true,           // ou une condition
      close: true,          // le dialog se ferme quand on clique
      disabled: false,      // peut dépendre d’un état
      loading: false,       // pour un loader durant l’axios
    },
  ]

  dialog.visible = true
}

const openConfirmDialog = () => {
  dialog.title = 'Valider les modifications'
  dialog.subtitle = ''
  dialog.text = 'Veux-tu enregistrer ces changements ?'
  dialog.icon = 'mdi-check-decagram-outline'
  dialog.useCustomBody = false

  dialog.buttons = [
    {
      key: 'no',
      label: 'Non',
      color: 'grey',
      variant: 'text',
      show: true,
      close: true,
    },
    {
      key: 'yes',
      label: 'Oui, enregistrer',
      color: 'primary',
      variant: 'flat',
      icon: 'mdi-content-save',
      show: true,
      close: false, // on garde le dialog ouvert le temps de l’axios
    },
  ]

  dialog.visible = true
}

const handleDialogAction = async (key, btn) => {
  if (key === 'cancel' || key === 'no') {
    return
  }

  if (key === 'delete') {
    // Exemple: appel API de suppression
    await deleteItem()
    // ici, on a close = true, donc le dialog est déjà fermé
  }

  if (key === 'yes') {
    // Exemple: on force le loading sur le bouton "yes"
    btn.loading = true
    btn.disabled = true

    try {
      await saveChanges()
      dialog.visible = false
    } finally {
      btn.loading = false
      btn.disabled = false
    }
  }
}

const deleteItem = async () => {
  // ton appel axios ou autre
  console.log('Suppression côté API...')
}

const saveChanges = async () => {
  // ton appel axios ou autre
  console.log('Sauvegarde côté API...')
}
</script>
